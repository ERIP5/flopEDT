<!-- This file is part of the FlOpEDT/FlOpScheduler project.               -->
<!-- Copyright (c) 2017                                                    -->
<!-- Authors: Iulian Ober, Paul Renaud-Goud, Pablo Seban, et al.           -->
<!--                                                                       -->
<!-- This program is free software: you can redistribute it and/or modify  -->
<!-- it under the terms of the GNU Affero General Public License as        -->
<!-- published by the Free Software Foundation, either version 3 of the    -->
<!-- License, or (at your option) any later version.                       -->
<!--                                                                       -->
<!-- This program is distributed in the hope that it will be useful, but   -->
<!-- WITHOUT ANY WARRANTY; without even the implied warranty of            -->
<!-- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU      -->
<!-- Affero General Public License for more details.                       -->
<!--                                                                       -->
<!-- You should have received a copy of the GNU Affero General Public      -->
<!-- License along with this program. If not, see                          -->
<!-- <http://www.gnu.org/licenses/>.                                       -->
<!--                                                                       -->
<!-- You can be released from the requirements of the license by purchasing -->
<!-- a commercial license. Buying such a license is mandatory as soon as   -->
<!-- you develop activities involving the FlOpEDT/FlOpScheduler software   -->
<!-- without disclosing the source code of your own applications.          -->

{% extends "base.html" %}
{% load static %}

{% csrf_token %}


{% block title %} Génération {% endblock %}
{% block content %}
<link rel="stylesheet" href="{% static "base/header.css" %}"/>
<link rel="stylesheet" href="{% static "base/better.css" %}"/>
<style type="text/css">


  .solver{
    display: flex;
    flex-direction: row;
    justify-content: space-evenly;
    height: 100%;
    width: 100%;
  }

  .solver > * {
    border: 1pt black solid;
    padding: 10px;
    flex-basis: 15%;
    margin: 10px;
  }

  .solver > * div.header {
    display: flex;
    background-color: #7a7a7a;
    padding: 0.6em;
    color: white;
    margin-bottom: 1em;
    height: 20px; 
    vertical-align: baseline;
    justify-content: space-between;
    align-items: center;
  }

  .resolve{
    border: #bfb;
    border-radius: 4px;
    background: #7a7a7a;
    height: 16px;
  }

  .settings{
    flex-grow: 1;
  }

  .console{
    flex-grow: 3; 
    background-color: black; 
    color: white;
  }
  
  /*
    Constraints
  */

  #constraints{
    flex-grow: 2;
    padding: 1em;
  }


  /*
    Checkbox
  */

  input[type=checkbox] + label {
    display: block;
    margin: 0.2em;
    cursor: pointer;
    padding: 0.2em;
  }

  input[type=checkbox] {
    display: none;
  }

  input[type=checkbox] + label:before {
    content: "\2714";
    border: 0.1em solid #000;
    border-radius: 0.2em;
    display: inline-block;
    width: 1em;
    height: 1em;
    padding-left: 0.2em;
    padding-bottom: 0.3em;
    margin-right: 0.2em;
    vertical-align: bottom;
    color: transparent;
    transition: .2s;
  }

  input[type=checkbox] + label:active:before {
    transform: scale(0);
  }

  input[type=checkbox]:checked + label:before {
    background-color: MediumSeaGreen;
    border-color: MediumSeaGreen;
    color: #fff;
  }

  input[type=checkbox]:disabled + label:before {
    transform: scale(1);
    border-color: #aaa;
  }

  input[type=checkbox]:checked:disabled + label:before {
    transform: scale(1);
    background-color: #bfb;
    border-color: #bfb;
  }

  .constraint{
    margin-bottom: 10px;
    border: #d3d3d3 2pt solid;
    padding: 5px;
    background-color: #ededed;
    border-radius: 4px;
  }

  .constraint > div{
    padding: 0.8em;
  }

  .title{
    font-size: 15px;
  }

  .title:hover ~ .hiddable {
    display: block;
  }

  #description{
    padding: 0 0.8em 0.4em 2.5em
  }

 
  .details{
    padding: 1em;
  }

  .comment{
    font-style: italic;
    font-size: 1em;
  }

  .mandatory{
    font-weight: 600;
  }

  .hidden, .hiddable{
    display: none;
  }

  .show{
    display: block;
  }

</style>
<script src="{% static "base/d3.v4.min.js" %}"></script>
  <!-- script src="https://d3js.org/d3.v4.min.js"></script -->
  <script>
    var text_all = '{{ text_all|safe }}';
    var week_year_list = {{ all_weeks|safe }};
    var train_prog_list = {{ all_train_progs|safe }};
    var department = '{{ department }}';
    var fetch_constraints_url_template = '{% url "solve_board:fetch_constraints" department 'tp' 1111 11 %}';
    var constraints = JSON.parse('{{ constraints|escapejs }}');
  </script>
  <template id="constraints_template">
    <div class="constraint">
      <input type="checkbox" />
      <label class="title"></label>
      <div id="description" class="description"></div>
      <div id="explanation" class="explanation"></div>
      <div id="comment" class="comment hiddable"></div>
      <div id="details" class="details hiddable"></div>
    </div>
  </template>

  <div class="solver">
    <div id="constraints">
        <div class="header"><span>Contraintes</span></div>
        <div style="margin: 15px 2px;">(*) Les contraintes apparaissant en gras - avec un poids non défini - seront prises en compte de manière obligatoire, les autres seront utilisées dans la résolution comme des préférences.</div>
        <div id="constraints_list"></div>
    </div>   
    <div id="settings" class="settings">
      <div class="header">
        <span>Configuration</span>
        <input type="button" id="launch" name="action" value="Go"/>
      </div>
      <div>Semaine : <select id="opti_date"></select></div>
      <div>Promotion : <select id="opti_train_prog"></select></div>
      <div>
        {% if solvers|length > 1 %}  
          <label for="solver">Solveur :</label>
          <select id="solver">
            {% for key, name in solvers %}
              <option value="{{ key }}">{{ name }}</option>
            {% endfor %}
          </select>
        {% else  %}
          <input type="hidden" id="solver" value="{{ solvers.0.0 }}"/>
        {% endif %}
      </div>
      <div>
        <label for="limit">Durée de résolution maximale (minutes):</label>
        <select id="limit">
          <option value="300" selected>5</option>
          <option value="600">10</option>
          <option value="1800">30</option>
          <option value="3600">60</option>
          <option value="0">Illimité</option>
        </select>
      </div>
    </div>
    <textarea class="console"></textarea>
  </div>

  
  <script type='text/javascript' src="{% static "solve_board/solve.js" %}"></script>
  
{% endblock %}
