{% extends "base.html" %}
{% load i18n %}
{% block title %} {% trans "Constraints manager" %} {% endblock %}
{% load static %}
{% block content %}
    <link rel="stylesheet" href="{% static 'cstmanager/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'cstmanager/css/style.css' %}">
    <script>
        let department = "{{ dept }}";
        let urlAcceptableValues = "{% url 'api:ttapp:constraints_fields-list' %}";
        let urlConstraints = "{% url 'api:ttapp:constraint-list' %}";
        let urlDetailConstraint = "{% url 'api:ttapp:constraint-detail' 'a' 0 %}".replace('/a/0', '');
        let urlDepartments = "{% url 'api:fetch:dept-list' %}";
        let urlGroups = "{% url 'api:fetch:idgroup-list' %}";
        let urlTutors = "{% url 'api:people:tutor-list' %}";
        let urlModules = "{% url 'api:fetch:idmodule-list' %}";
        let urlCourseTypes = "{% url 'api:fetch:idcoursetype-list' %}";
        let urlTutorsID = "{% url 'api:fetch:idtutor-list' %}";
        let urlWeeks = "{% url 'api:base:weeks-list' %}";
        let urlTrainingPrograms = "{% url 'api:fetch:idtrainprog-list' %}";
        let urlConstraintTypes = "{% url 'api:ttapp:constraint_types-list' %}";
    </script>
    <div class="container-fluid">
        <!-- Content -->
        <div class="row">
            <!-- Search column -->
            <div class="col col-2 border-end border-top border-dark pt-5">
                <div class="mb-3">
                    <button id="nav-new-constraint" type="button" class="btn btn-primary w-100">
                        {% trans "New Constraint" %}
                    </button>
                </div>
                <div class="mb-3">
                    <button id="discard-changes" type="button" class="btn btn-danger w-100">
                        {% trans "Discard Changes" %}
                    </button>
                </div>
                <div class="mb-3">
                    <button id="apply-changes" type="button" class="btn btn-success w-100">
                        {% trans "Commit Changes" %}
                    </button>
                </div>
                <div class="mb-3">
                    <button id="fetch-constraints" type="button" class="btn btn-primary w-100">
                        {% trans "Reload Constraints" %}
                    </button>
                </div>
                <div class="search-bar mb-3">
                    <input type="text" class="form-control" id="input-search" placeholder="Search">
                </div>
                <div id="filters" class="search-bar pad-children mb-3">
                    <input type="text" class="form-control mb-3" id="input-tutor" placeholder="Tutor">
                    <input type="text" class="form-control mb-3" id="input-module" placeholder="Module">
                    <input type="text" class="form-control mb-3" id="input-course" placeholder="Course">
                    <input type="date" class="form-control mb-3" id="input-date" placeholder="Date">
                </div>
                <div class="mb-3 text-center">
                    <button class="btn btn-info" id="clear-filters">
                        {% trans "Clear Filters" %}
                    </button>
                </div>
                <div class="search-bar mb-3">
                    <div class="form-check">
                        <label for="constraints-group-mode">{% trans "Group" %}</label>
                        <select name="group-mode" id="constraints-group-mode">
                            <option value="none">{% trans "None" %}</option>
                            <option value="class">{% trans "by type" %}</option>
                            <option value="status">{% trans "by status" %}</option>
                        </select>
                    </div>
                </div>
            </div>
            <!-- Edit constraint modal -->
            <div class="modal fade" id="constraint-edit-popup" data-bs-backdrop="static" data-bs-keyboard="false"
                 tabindex="-1"
                 aria-labelledby="constraint-edit-popup-label" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="constraint-edit-popup-label">{% trans "Edit constraint" %}</h5>
                        </div>
                        <div class="modal-body">
                            <div id="constraint-edit-alert-container"></div>
                            <!-- Type -->
                            <div class="mb-3">
                                <select id="constraint-edit-type" class="form-select" aria-label="Type de contrainte"
                                        onchange="updateParamsListNewConstraint()">
                                    <option selected disabled>{% trans "Select type..." %}</option>
                                </select>
                            </div>
                            <!-- Title -->
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="constraint-edit-title">
                                <label for="constraint-edit-title">{% trans "Title" %}</label>
                            </div>
                            <!-- Comment -->
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="constraint-edit-comment"></input>
                                <label for="constraint-edit-comment">{% trans "Comment" %}</label>
                            </div>
                            <!-- Parameters -->
                            <div id="constraint-edit-params" class="accordion mb-3">

                            </div>
                            <!-- Activation -->
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" role="switch" value=""
                                       id="constraint-edit-activation">
                                <label class="form-check-label ps-1" for="constraint-edit-activation">
                                    {% trans "Activated?" %}
                                </label>
                            </div>
                            <!-- Weight -->
                            <div class="mb-3">
                                <label for="constraint-edit-weight-slider"
                                       class="form-label text-center">{% trans "Weight :" %}</label>
                                <input type="range" class="form-range" min="1" max="9" step="1"
                                       id="constraint-edit-weight-slider"
                                       oninput="updateEditConstraintWeightDisplay('constraint-edit-weight-value', value)"
                                       value="1">
                                <div id="constraint-edit-weight-value" class="text-center">1</div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" id="cancel-edit-constraint" class="btn btn-secondary">
                                {% trans "Cancel" %}
                            </button>
                            <button type="button" id="confirm-edit-constraint" class="btn btn-primary">
                                {% trans "Save changes" %}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Constraints column -->
            <div class="col container w-auto" id="constraints-body">
                <button id="show-disabled" class="float">{% trans "Show Disabled" %}</button>
                <button id="show-solver" class="float">{% trans "Preanalyse" %}</button>
                <!-- Header -->
                <div id="constraints-header" class="row border-top border-bottom border-dark">
                    <div id="constraint-info" hidden="hidden">
                        <div id="constraint-info-body container-fluid" class="h-100">
                            <div class="row h-100">
                                <!-- Title -->
                                <div class="col-auto border border-dark">
                                    <label for="constraint-header-title" class="form-label">{% trans "Title" %}</label>
                                    <input type="text" readonly id="constraint-header-title"
                                           class="form-control-plaintext">
                                </div>
                                <!-- Comment -->
                                <div class="col-auto border border-dark">
                                    <label for="constraint-header-comment" class="form-label">{% trans "Comments" %}</label>
                                    <input type="text" readonly id="constraint-header-comment"
                                           class="form-control-plaintext">
                                </div>
                                <!-- Parameters -->
                                <div class="col border border-dark">
                                    <label class="form-label">{% trans "Parameters" %}</label>
                                    <div id="params" class="form">
                                    </div>
                                </div>
                                <!-- Activation -->
                                <div class="col-auto border border-dark d-flex align-items-center">
                                    <div class="form">
                                        <label id="constraint-header-activation" class="form-label">
                                        </label>
                                    </div>
                                </div>
                                <!-- Weight -->
                                <div class="col-auto border border-dark text-center">
                                    <div class="form">
                                        <label class="form-label">{% trans "Weight" %}</label>
                                        <br/>
                                        <label id="constraint-header-weight" class="form-label">
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="constraints-all" class="row container-fluid">
                    <div class="row">
                        <div id="constraints-enabled" class="col-9 border-end border-dark"></div>
                        <div id="constraints-disabled" class="col-3 constraints-disabled"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer -->
        <div id="constraints-footer" class="row p-2 pb-0 border-top border-dark">
            <div class="container col-auto">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="constraints-select-all">
                    <label class="form-check-label" for="constraints-select-all">
                        {% trans "Select all" %}
                    </label>
                </div>
            </div>
            <div class="col">
                <div>{% trans "Selected constraints :" %}</div>
                <div id="num-selected-constraints">0</div>
            </div>
            <div class="col-auto">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-auto">
                            <label for="selected-constraints-edit-weight-slider"
                                   class="form-label text-center">{% trans "Weight :" %}</label>
                        </div>
                        <div class="col-auto">
                            <div id="selected-constraints-edit-weight-value" class="text-center">1</div>

                        </div>
                    </div>
                    <div class="row">
                        <input type="range" class="form-range" min="1" max="9" step="1"
                               id="selected-constraints-edit-weight-slider"
                               oninput="updateEditConstraintWeightDisplay('selected-constraints-edit-weight-value', value)"
                               value="1">
                    </div>
                </div>
            </div>
            <div class="col-auto">
                <div class="btn-group" role="group" aria-label="Edit selected constraints">
                    <button class="btn btn-primary w-auto" id="selected-constraints-edit-weight">
                        {% trans "Set weight" %}
                    </button>
                    <button class="btn btn-danger w-auto" id="selected-constraints-delete">
                        {% trans "Delete" %}
                    </button>
                </div>
            </div>
        </div>
        <img id="icon-weight" style="display: none;" src="{% static 'cstmanager/icons/icon_weight.png' %}">
        <img id="icon-gears" style="display: none;" src="{% static 'cstmanager/icons/icon_gears.png' %}">
        <img id="icon-check" style="display: none;" src="{% static 'cstmanager/icons/icon_check.png' %}">
    </div>
{% endblock %} {% block javascript %}
    <script type="text/javascript" src="{% static 'cstmanager/js/popper.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'cstmanager/js/bootstrap.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'base/helpers.js' %}"></script>
    <script type="text/javascript" src="{% static 'cstmanager/js/mockup_request.js' %}"></script>
    <script type="text/javascript" src="{% static 'cstmanager/js/script.js' %}"></script>
{% endblock %}
